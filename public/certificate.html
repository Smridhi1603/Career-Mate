<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Career Mate Certificate</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f0f4ff; }
    .cert { background:#fff; border:10px solid royalblue; padding:40px; border-radius:12px; box-shadow:0 8px 20px rgba(0,0,0,.1); }
    .brand { color: royalblue; font-weight:800; }
  </style>
</head>
<body class="py-5">
  <div class="container">
    <div class="cert text-center">
      <h1 class="brand mb-4">Career Mate</h1>
      <h2>Certificate of Completion</h2>
      <p class="lead">This certifies that</p>
      <h3 id="certName" class="fw-bold">—</h3>
      <p class="lead">has successfully completed the course</p>
      <h4 id="certCourse" class="fw-bold">—</h4>
      <p class="mt-3">Issued on <span id="certDate">—</span></p>
      <p>Certificate Code: <span id="certCode" class="fw-bold">—</span></p>
      <div class="mt-4">
        <button class="btn btn-primary" onclick="window.print()">Print / Save as PDF</button>
        <a href="dashboard.html" class="btn btn-outline-secondary">Back to Dashboard</a>
      </div>
    </div>
  </div>
  <script>
    async function loadCert(){
      try {
        const params = new URLSearchParams(location.search);
        const courseId = params.get('courseId');
        const score = params.get('score');
        const total = params.get('total');
        
        if (!courseId) { 
          alert('❌ Missing course information');
          return; 
        }
        
        // Get current user
        const userRes = await fetch('/api/auth/me');
        const userData = await userRes.json();
        
        if (!userData.loggedIn) {
          alert('❌ Please login first');
          window.location.href = 'login.html';
          return;
        }
        
        // Set user name
        document.getElementById('certName').textContent = userData.username;
        
        // Set issue date
        document.getElementById('certDate').textContent = new Date().toDateString();
        
        // Generate simple certificate code
        const certCode = Math.random().toString(36).slice(2, 10).toUpperCase();
        document.getElementById('certCode').textContent = certCode;
        
        // Load course title
        try {
          const courseRes = await fetch('assets/courses.json');
          const courseData = await courseRes.json();
          const course = (courseData.courses||[]).find(x=>x.id===courseId);
          document.getElementById('certCourse').textContent = course ? course.title : courseId.toUpperCase();
        } catch(err) {
          document.getElementById('certCourse').textContent = courseId.toUpperCase();
        }
        
        console.log('✅ Certificate generated successfully');
      } catch (error) {
        console.error('❌ Error:', error);
        alert('❌ Error loading certificate');
      }
    }
    loadCert();
  </script>
</body>
</html>
